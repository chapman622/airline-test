<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TT Globals Debug</title>
    <style>
        body {
            background: transparent;
            color: lime;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden;
            pointer-events: none; /* Click through to game */
        }
        #container {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 450px;
            max-height: 80vh;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.65); /* Semi-transparent dark for readability */
            padding: 15px;
            border-radius: 10px;
            border: 1px solid lime;
            pointer-events: auto; /* Box is interactive */
            font-size: 14px;
            z-index: 9999;
        }
        h1 {
            color: cyan;
            margin: 0 0 10px;
            font-size: 18px;
        }
        pre {
            background: transparent;
            color: lime;
            margin: 0;
            padding: 0;
            white-space: pre-wrap;
            font-family: monospace;
        }
        p {
            margin: 0 0 10px;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div id="container">
        <h1>Transport Tycoon Globals Live Debug</h1>
        <p>Updates every 2 seconds + initial cache request. Watch notification during airline jobs.</p>
        <pre id="output">Loading globals...</pre>
    </div>

    <!-- CACHE-BUST: Auto-add timestamp if missing -->
    <script>
        (function() {
            const url = new URL(window.location.href);
            if (!url.searchParams.has('v')) {
                url.searchParams.set('v', Date.now());
                window.location.replace(url.toString());
            }
        })();
    </script>

    <script>
        function updateDisplay() {
            const globals = {
                notification: window.notification || 'undefined',
                job_name: window.job_name || 'undefined',
                subjob_name: window.subjob_name || 'undefined',
                street: window.street || 'undefined',
                zoneName: window.zoneName || 'undefined',
                waypoint: window.waypoint || 'undefined',
                waypoint_x: window.waypoint_x || 'undefined',
                waypoint_y: window.waypoint_y || 'undefined',
            };

            let text = 'Current globals:\n\n';
            for (const [key, value] of Object.entries(globals)) {
                text += `${key.padEnd(15)}: ${value}\n`;
            }

            document.getElementById('output').textContent = text;
            console.log('Globals update:', globals);
        }

        // Update every 2 seconds
        setInterval(updateDisplay, 2000);
        updateDisplay(); // initial

        // Force refresh of cached data on load
        window.parent.postMessage({ 
            type: "getNamedData", 
            keys: [
                "notification", 
                "job_name", 
                "subjob_name", 
                "street", 
                "zoneName", 
                "waypoint", 
                "waypoint_x", 
                "waypoint_y"
            ] 
        }, "*");
        console.log('Requested fresh cached data via getNamedData');

        console.log('Debug monitor started - ' + new Date().toISOString());
    </script>
</body>
</html>
